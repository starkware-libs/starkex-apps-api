{
    "openrpc": "1.2.4",
    "info": {
        "title": "StarkEx NFT Application API",
        "description": "A specification of a standard interface for NFT applications using StarkEx",
        "version": "0.1.0"
    },
    "methods": [
        {
            "name": "starkex_getUserAssets",
            "description": "Retrieve a user's known assets",
            "params": [
                {
                    "name": "stark_key",
                    "description": "The stark key identifying the user",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/STARK_KEY"
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": false,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "assets": {
                            "description": "The assets for this user",
                            "type": "array",
                            "items": {
                                "$ref": "#/components/schemas/NFT_ASSET"
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    }
                }
            }
        },
        {
            "name": "starkex_getAsset",
            "description": "Given an asset id retrieve all the asset information",
            "params": [
                {
                    "name": "asset_id",
                    "description": "The asset's id",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/ASSET_ID"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "$ref": "#/components/schemas/NFT_ASSET"
                }
            },
            "errors": [
                {
                    "$ref": "#/components/errors/ASSET_NOT_FOUND"
                }
            ]
        },
        {
            "name": "starkex_getAssetsByFilter",
            "description": "Retrieve all assets that adhere to the given filter",
            "params": [
                {
                    "name": "filter",
                    "description": "The filter used to choose the assets to return",
                    "required": true,
                    "schema": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/KEYWORD"
                        }
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "assets": {
                            "type": "array",
                            "items": {
                                "$ref": "#/components/schemas/NFT_ASSET"
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    },
                    "required": [
                        "assets"
                    ]
                }
            }
        },
        {
            "name": "starkex_getCollectionInfo",
            "description": "Given a collection id, retrieve the collection information",
            "params": [
                {
                    "name": "collection_id",
                    "description": "The requested collection id",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/COLLECTION_ID"
                    }
                }
            ],
            "result": {
                "name": "result",
                "description": "The requested collection information",
                "schema": {
                    "$ref": "#/components/schemas/NFT_COLLECTION_INFO"
                }
            },
            "errors": [
                {
                    "$ref": "#/components/errors/COLLECTION_NOT_FOUND"
                }
            ]
        },
        {
            "name": "starkex_getCollectionContent",
            "description": "Given a collection id, retrieve assets in the collection",
            "params": [
                {
                    "name": "collection_id",
                    "description": "The requested collection id",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/COLLECTION_ID"
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "assets": {
                            "type": "array",
                            "items": {
                                "$ref": "#/components/schemas/NFT_ASSET"
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    },
                    "required": [
                        "assets"
                    ]
                }
            },
            "errors": [
                {
                    "$ref": "#/components/errors/COLLECTION_NOT_FOUND"
                }
            ]
        },
        {
            "name": "starkex_getCollectionsByFilter",
            "description": "Given a filter, return all collection info that matches the filter",
            "params": [
                {
                    "name": "filter",
                    "description": "The filter used to choose the collections to return",
                    "required": true,
                    "schema": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/KEYWORD"
                        }
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "collections": {
                            "type": "array",
                            "items": {
                                "$ref": "#/components/schemas/NFT_COLLECTION_INFO"
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    },
                    "required": [
                        "collections"
                    ]
                }
            }
        },
        {
            "name": "starkex_submitOrder",
            "description": "Submit an order to buy or sell an NFT",
            "params": [
                {
                    "name": "order",
                    "description": "The submitted order",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/ORDER"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": true
            }
        },
        {
            "name": "starkex_getOpenOrdersByFilter",
            "description": "Get all the open orders that match the given filter",
            "params": [
                {
                    "name": "filter",
                    "description": "The filter used to choose the orders",
                    "required": true,
                    "schema": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/KEYWORD"
                        }
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "orders": {
                            "type": "array",
                            "items": {
                                "$ref": "#/components/schemas/ORDER"
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    },
                    "required": [
                        "orders"
                    ]
                }
            }
        },
        {
            "name": "starkex_getUserOrderHistory",
            "description": "For a given user, get the order history for that user",
            "params": [
                {
                    "name": "stark_key",
                    "description": "The stark key identifying the user",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/STARK_KEY"
                    }
                },
                {
                    "name": "page_request",
                    "description": "The information required to return a specific page of results",
                    "required": true,
                    "schema": {
                        "$ref": "#/components/schemas/RESULT_PAGE_REQUEST"
                    }
                }
            ],
            "result": {
                "name": "result",
                "schema": {
                    "type": "object",
                    "properties": {
                        "orders": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "order": {
                                        "$ref": "#/components/schemas/ORDER"
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "OPEN",
                                            "CLOSED",
                                            "EXPIRED",
                                            "SETTLED",
                                            "CANCELLED"
                                        ]
                                    }
                                }
                            }
                        },
                        "continuation_token": {
                            "description": "A pointer to the last element of the delivered page, can be used to sent with subsequent queries to more pages",
                            "type": "string"
                        }
                    },
                    "required": [
                        "orders"
                    ]
                }
            }
        }
    ],
    "components": {
        "schemas": {
            "ORDER": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "BUY",
                            "SELL"
                        ]
                    },
                    "vault_id": {
                        "description": "The vault id holding the bought/sold NFT",
                        "$ref": "#/components/schemas/VAULT_ID"
                    },
                    "asset_id": {
                        "description": "The asset id to buy/sell",
                        "$ref": "#/components/schemas/ASSET_ID"
                    },
                    "amount": {
                        "description": "The amount to sell/buy",
                        "type": "integer",
                        "minimum": 1
                    },
                    "expiration_timestamp": {
                        "description": "The order expiration time",
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 4194303,
                        "$comment": "upper limit is 2^22-1, taken from StarkEx code - ExpirationTimestampField"
                    },
                    "signature": {
                        "description": "The user's signature on the order",
                        "$ref": "#/components/schemas/SIGNATURE"
                    },
                    "fee_limit": {
                        "$ref": "#/components/schemas/FEE_LIMIT"
                    }
                }
            },
            "VAULT_ID": {
                "description": "A vault id, represented as a hex number",
                "type": "string",
                "pattern": "^0x[a-fA-F0-9]{16}$",
                "$comment": "This is a superset of both validium and rollup vault ranges"
            },
            "NFT_COLLECTION_INFO": {
                "type": "object",
                "properties": {
                    "name": {
                        "description": "The name of the NFT collection",
                        "type": "string"
                    },
                    "description": {
                        "description": "A description of the NFT collection",
                        "type": "string"
                    },
                    "contract_address": {
                        "description": "Address of the NFT contract on L1",
                        "$ref": "#/components/schemas/ETH_ADDRESS"
                    },
                    "collection_image_url": {
                        "description": "A URL to an image for the collection",
                        "type": "string"
                    },
                    "keywords": {
                        "description": "List of keywords associated with this collection",
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/KEYWORD"
                        }
                    },
                    "metadata_scheme": {
                        "description": "Schema of metadata properties for NFTs in this collection",
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "key": {
                                    "type": "string"
                                },
                                "is_in_blob": {
                                    "description": "Designates whether this key is part of the minting blob",
                                    "type": "boolean"
                                },
                                "type": {
                                    "type": "string",
                                    "enum": [
                                        "TEXT",
                                        "DISCRETE",
                                        "ENUM"
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "RESULT_PAGE_REQUEST": {
                "type": "object",
                "properties": {
                    "continuation_token": {
                        "description": "a pointer to the last element of the delivered page, use this token in a subsequent query to obtain the next page",
                        "type": "string"
                    },
                    "chunk_size": {
                        "type": "integer",
                        "minimum": 1
                    }
                },
                "required": [
                    "chunk_size"
                ]
            },
            "NFT_ASSET": {
                "type": "object",
                "properties": {
                    "name": {
                        "description": "The name of the NFT",
                        "type": "string"
                    },
                    "description": {
                        "description": "A description of the NFT",
                        "type": "string"
                    },
                    "owner_key": {
                        "description": "The stark key of the owner of the NFT",
                        "$ref": "#/components/schemas/STARK_KEY"
                    },
                    "contract_address": {
                        "description": "Address of the NFT contract on L1",
                        "$ref": "#/components/schemas/ETH_ADDRESS"
                    },
                    "collection_id": {
                        "description": "The id of the collection this NFT belongs to",
                        "$ref": "#/components/schemas/COLLECTION_ID"
                    },
                    "asset_id": {
                        "$ref": "#/components/schemas/ASSET_ID"
                    },
                    "asset_info": {
                        "$ref": "#/components/schemas/ASSET_INFO"
                    },
                    "content": {
                        "description": "The content of the NFT (or link to it)",
                        "type": "string"
                    },
                    "proof": {
                        "type": "object",
                        "properties": {
                            "path": {
                                "$ref": "#/components/schemas/MERKLE_PATH"
                            },
                            "root": {
                                "description": "The state root where the path is relevant",
                                "$ref": "#/components/schemas/STATE_ROOT"
                            }
                        }
                    },
                    "metadata": {
                        "$ref": "#/components/schemas/METADATA_DICT"
                    },
                    "keywords": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/KEYWORD"
                        }
                    }
                }
            },
            "METADATA_DICT": {
                "type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "key": {
                            "type": "string"
                        },
                        "value": {
                            "type": "string"
                        },
                        "type": {
                            "type": "string",
                            "enum": [
                                "TEXT",
                                "DISCRETE",
                                "ENUM"
                            ]
                        }
                    }
                }
            },
            "STARK_KEY": {
                "$ref": "#/components/schemas/NUM_AS_HEX"
            },
            "NUM_AS_HEX": {
                "description": "An integer number in hex format (0x...)",
                "type": "string",
                "pattern": "^0x[a-fA-F0-9]+$"
            },
            "ETH_ADDRESS": {
                "type": "string",
                "$comment": "An ethereum address",
                "description": "an ethereum address represented as 40 hex digits",
                "pattern": "^0x[a-fA-F0-9]{40}$"
            },
            "ASSET_INFO": {
                "description": "The asset info calculated for a given asset",
                "type": "string",
                "pattern": "^0x[a-fA-F0-9]{72}$"
            },
            "ASSET_ID": {
                "description": "The asset id of for an NFT (ERC721) asset. 32 bytes with 5 MSB zeroed",
                "type": "string",
                "pattern": "^0x0[0-7]{1}[a-fA-F0-9]{62}$"
            },
            "MERKLE_PATH": {
                "description": "A series of bytes denoting a path in a merkle tree. Bytes given as pairs of hex digits",
                "$ref": "#/components/schemas/BYTES"
            },
            "SIGNATURE": {
                "description": "A signature provided as a pair of numbers",
                "type": "object",
                "properties": {
                    "r": {
                        "$ref": "#/components/schemas/BYTES"
                    },
                    "s": {
                        "$ref": "#/components/schemas/BYTES"
                    }
                }
            },
            "BYTES": {
                "description": "A series of bytes denoted as pairs of hex digits",
                "type": "string",
                "pattern": "^0x([a-fA-F0-9]{2})+$"
            },
            "TOKEN_ID": {
                "description": "An ID for a token",
                "type": "string",
                "pattern": "^0x[a-fA-F0-9]{64}$",
                "$comment": "A generalized case - 251 bits (and a bit extra)"
            },
            "STATE_ROOT": {
                "description": "The global state root",
                "type": "string",
                "pattern": "^0x[a-fA-F0-9]{64}$",
                "$comment": "251 bits (and a bit extra)"
            },
            "FEE_LIMIT": {
                "description": "Fee limit information provided by the user",
                "type": "object",
                "properties": {
                    "token_id": {
                        "description": "The token id of the fee",
                        "$ref": "#/components/schemas/TOKEN_ID"
                    },
                    "source_vault_id": {
                        "description": "The id of the vault from which the fee can be taken",
                        "$ref": "#/components/schemas/VAULT_ID"
                    },
                    "fee_limit": {
                        "description": "The fee limit, proportional to the signed buy/sell amount",
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 9223372036854775808,
                        "$comment": "upper limit is 2^63, taken from definition of AmountField"
                    }
                }
            },
            "KEYWORD": {
                "description": "A label, alphanumeric English + underscore, with no spaces",
                "type": "string",
                "pattern": "^[a-zA-Z0-9_]+$"
            },
            "COLLECTION_ID": {
                "type": "number",
                "minimum": 0
            }
        },
        "errors": {
            "ASSET_NOT_FOUND": {
                "code": 1,
                "message": "Requested asset was not found"
            },
            "COLLECTION_NOT_FOUND": {
                "code": 2,
                "message": "Requested collection not found"
            }
        }
    }
}
